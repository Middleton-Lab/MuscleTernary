<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MuscleTernary">
<title>Working with stl files • MuscleTernary</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.7/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with stl files">
<meta property="og:description" content="MuscleTernary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MuscleTernary</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.24</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/centroid.html">Working with stl files</a>
    <a class="dropdown-item" href="../articles/ternary_plot.html">Make a ternary plot</a>
    <a class="dropdown-item" href="../articles/ternary_plot_xfiber.html">Make a ternary plot from Xfiber data</a>
    <a class="dropdown-item" href="../articles/ternary_animation.html">Animate a ternary plot</a>
    <a class="dropdown-item" href="../articles/make_maya_mel_file.html">Make Maya mel File</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Working with stl files</h1>
            
      
      
      <div class="d-none name"><code>centroid.Rmd</code></div>
    </div>

    
    
<p>Stereolithography (<code>.stl</code>) mesh files can be exported from
most segmentation software. In our workflow, there are two files for
each muscle, wherein the origin and insertion attachment areas of the
muscle are “mapped” onto the surface of a bone model (see Cost et al.,
2020, 2022; Wilken et al., 2019, 2020 for description).</p>
<p>There is no directionality to the calculation of either centroid size
(area) or location from a mesh, so either surface can be the “origin”.
If you are generating Maya mel code for generating a model + muscle
vectors, then the order matters to get the arrowhead on the correct end,
however there is a flag in <code><a href="../reference/make_mel.html">make_mel()</a></code> to reverse the
arrows.</p>
<p><strong>Important</strong>: you should export stl meshes as
<em>binary, with little endian byte encoding</em> (not ASCII or binary
with big endian). If not, you will get a cryptic error that will be very
difficult to diagnose. <code>MuscleTernary</code> has a wrapper function
<code><a href="../reference/read_stl.html">read_stl()</a></code> around the <code>rgl</code> pachage
<code>readSTL()</code> function which <em>should</em> catch any read
errors, but it hasn’t been tested for all possible cases (i.e., those I
haven’t encountered yet). If you are reading stl files in directly, use
<code><a href="../reference/read_stl.html">read_stl()</a></code>.</p>
<p>The package includes a pair of files that map the origin and
insertion areas of the left m. Pterygoideus dorsalis (mPTd):
<code>L_mPTd_Or.stl</code> and <code>L_mPTd_Ins.stl</code>. The right
mPTd are also included and will be used later in this tutorial.</p>
<p><code>system.file(...)</code> allows us to open a file that was
installed with the package. In most cases, you would use a path to your
mesh file in its place.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MuscleTernary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the local path to the stl file.</span></span>
<span><span class="va">stl_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                        <span class="st">"L_mPTd_Ins.stl"</span>,</span>
<span>                        package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_stl.html">read_stl</a></span><span class="op">(</span><span class="va">stl_path</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/read_stl.html">read_stl()</a></code> returns a matrix with (x, y, z) coordinates
of the vertices of the mesh triangles.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;           [,1]       [,2]      [,3]</span></span>
<span><span class="co">#&gt;  [1,] 80.15495 -11.792723 -570.9537</span></span>
<span><span class="co">#&gt;  [2,] 80.72946 -11.396370 -571.3650</span></span>
<span><span class="co">#&gt;  [3,] 79.95493 -11.389565 -571.5762</span></span>
<span><span class="co">#&gt;  [4,] 80.84564  -9.106031 -573.8356</span></span>
<span><span class="co">#&gt;  [5,] 80.04286  -9.215285 -573.6454</span></span>
<span><span class="co">#&gt;  [6,] 80.41844  -9.701449 -573.2871</span></span>
<span><span class="co">#&gt;  [7,] 80.15350 -10.181118 -572.8048</span></span>
<span><span class="co">#&gt;  [8,] 79.55407 -10.362929 -572.4216</span></span>
<span><span class="co">#&gt;  [9,] 80.77268 -10.513458 -572.4617</span></span>
<span><span class="co">#&gt; [10,] 80.15495 -11.792723 -570.9537</span></span>
<span></span>
<span><span class="co"># Dimensions of the matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">stl</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6423    3</span></span></code></pre></div>
<div class="section level2">
<h2 id="centroid-location-and-centroid-size">Centroid location and centroid size<a class="anchor" aria-label="anchor" href="#centroid-location-and-centroid-size"></a>
</h2>
<p>The centroid location (often just the “centroid”) of the mesh is
simply the mean of each column. To simply usage,
<code><a href="../reference/centroid_location.html">centroid_location()</a></code> takes a single argument with the string
path to the file.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">stl</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   64.784475    8.529847 -567.928419</span></span>
<span></span>
<span><span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="va">stl_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   64.784475    8.529847 -567.928419</span></span></code></pre></div>
<p>The size of the centroid is the 3D distance of each vertex from the
centroid.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the centroid</span></span>
<span><span class="va">centroid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="va">stl_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the distance formula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">stl</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">stl</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">stl</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2576.131</span></span>
<span></span>
<span><span class="fu"><a href="../reference/centroid_size.html">centroid_size</a></span><span class="op">(</span><span class="va">stl_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2576.131</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="area-of-an-stl-mesh">Area of an <code>stl</code> mesh<a class="anchor" aria-label="anchor" href="#area-of-an-stl-mesh"></a>
</h2>
<p>The area of an stl mesh is the summed area of all the triangles
making up the mesh.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stl_area.html">stl_area</a></span><span class="op">(</span><span class="va">stl_path</span><span class="op">)</span></span>
<span><span class="va">area</span></span>
<span><span class="co">#&gt; [1] 3280.389</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="deriving-ternary-coordinates-from-a-pair-of-stl-meshes">Deriving ternary coordinates from a pair of stl meshes<a class="anchor" aria-label="anchor" href="#deriving-ternary-coordinates-from-a-pair-of-stl-meshes"></a>
</h2>
<p>To get to ternary coordinated from stl mesh files, first we need the
locations of the centroids. Here we use the left mPTd:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">L_mPTd_Or</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"L_mPTd_Or.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">L_mPTd_Ins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"L_mPTd_Ins.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/centroid_location.html">centroid_location()</a></code> returns a 3-element vector, which we
can extract into a tibble. There are other ways to do this step, but
this is the most straightforward, if more verbose.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mPTd_L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  muscle <span class="op">=</span> <span class="st">"mPTd"</span>,</span>
<span>  side <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>  x_origin <span class="op">=</span> <span class="va">L_mPTd_Or</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  y_origin <span class="op">=</span> <span class="va">L_mPTd_Or</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  z_origin <span class="op">=</span> <span class="va">L_mPTd_Or</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>  x_insertion <span class="op">=</span> <span class="va">L_mPTd_Ins</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  y_insertion <span class="op">=</span> <span class="va">L_mPTd_Ins</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  z_insertion <span class="op">=</span> <span class="va">L_mPTd_Ins</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mPTd_L</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">#&gt;   muscle side  x_origin y_origin z_origin x_insertion y_insertion z_insertion</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mPTd   left      26.7     21.4    -<span style="color: #BB0000;">456.</span>        64.8        8.53       -<span style="color: #BB0000;">568.</span></span></span></code></pre></div>
<p>We then repeat the same for the right mPTd and bind the left and
right together to have some comparative data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R_mPTd_Or</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"R_mPTd_Or.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">R_mPTd_Ins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centroid_location.html">centroid_location</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"R_mPTd_Ins.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mPTd_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  muscle <span class="op">=</span> <span class="st">"mPTd"</span>,</span>
<span>  side <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>  x_origin <span class="op">=</span> <span class="va">R_mPTd_Or</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  y_origin <span class="op">=</span> <span class="va">R_mPTd_Or</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  z_origin <span class="op">=</span> <span class="va">R_mPTd_Or</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>  x_insertion <span class="op">=</span> <span class="va">R_mPTd_Ins</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  y_insertion <span class="op">=</span> <span class="va">R_mPTd_Ins</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  z_insertion <span class="op">=</span> <span class="va">R_mPTd_Ins</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mPTd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">mPTd_L</span>, <span class="va">mPTd_R</span><span class="op">)</span></span>
<span><span class="va">mPTd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;   muscle side  x_origin y_origin z_origin x_insertion y_insertion z_insertion</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mPTd   left      26.7     21.4    -<span style="color: #BB0000;">456.</span>        64.8       8.53        -<span style="color: #BB0000;">568.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> mPTd   right    -<span style="color: #BB0000;">23.4</span>     18.7    -<span style="color: #BB0000;">460.</span>       -<span style="color: #BB0000;">67.2</span>      -<span style="color: #BB0000;">0.988</span>       -<span style="color: #BB0000;">560.</span></span></span></code></pre></div>
<p>Passing that tibble to <code><a href="../reference/coords_to_ternary.html">coords_to_ternary()</a></code> produces
ternary coordinates. By not using the <code>grouping</code> argument, we
get coordinates for both left and right (not the average of the two). We
can then make a simple ternary plot comparing the muscles’
orientations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/coords_to_ternary.html">coords_to_ternary</a></span><span class="op">(</span><span class="va">mPTd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   muscle side      x     y     z</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mPTd   left   10.2  1.16  88.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> mPTd   right  15.4  3.09  81.5</span></span>
<span></span>
<span><span class="fu"><a href="../reference/coords_to_ternary.html">coords_to_ternary</a></span><span class="op">(</span><span class="va">mPTd</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/ggtern.html" class="external-link">ggtern</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, color <span class="op">=</span> <span class="va">side</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="centroid_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="estimating-pcsa">Estimating PCSA<a class="anchor" aria-label="anchor" href="#estimating-pcsa"></a>
</h2>
<p>The origin and insertion meshes can be used to estimate physiological
cross-sectional area (PCSA; see Sellers, et al., 2017 for additional
discussion). PSCA is calculated as the volume of a frustum with areas
equal to the attachments (<span class="math inline">\(V_m\)</span>)
divided by fascicle length (<span class="math inline">\(l_f\)</span>)
and multiplied by the cosine of the angle of pennation (<span class="math inline">\(\theta\)</span>).</p>
<p><span class="math display">\[PCSA = \frac{V_m}{l_f} \cdot
\cos(\theta)\]</span></p>
<p>where</p>
<p><span class="math display">\[V_m = \frac{l_m}{3} \cdot (A_{or} \cdot
A_{ins} + \sqrt{A_{or} \cdot A_{ins}})\]</span></p>
<p><span class="math inline">\(l_m\)</span> is the distance from the
centroid of the origin to the centroid of the insertion and <span class="math inline">\(A_{or}\)</span> and <span class="math inline">\(A_{ins}\)</span> are the origin and insertion
areas, respectively.</p>
<p>For a pair of stl meshes and values for <span class="math inline">\(l_f\)</span> (<code>fascicle_length</code> which
defaults to 1) and <span class="math inline">\(\theta\)</span>
(<code>theta</code> which defaults to 0, no pennation),
<code><a href="../reference/PCSA.html">pcsa()</a></code> calculates PCSA.</p>
<p>Note that by default <code><a href="../reference/PCSA.html">pcsa()</a></code> uses the areas of the stl
meshes. The Boolean flag <code>stl_area</code> will use centroid size if
set to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PCSA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCSA.html">pcsa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                         <span class="st">"L_mPTd_Or.stl"</span>,</span>
<span>                         package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                         <span class="st">"L_mPTd_Ins.stl"</span>,</span>
<span>                         package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assuming theta is measured in radians.</span></span>
<span><span class="co">#&gt; Assuming units are mm.</span></span>
<span><span class="co">#&gt; Using mesh area for calculation.</span></span>
<span><span class="va">PCSA</span></span>
<span><span class="co">#&gt; [1] 1670.846</span></span></code></pre></div>
<p>By default, <code><a href="../reference/PCSA.html">pcsa()</a></code> assumes that <span class="math inline">\(\theta\)</span> is measured in radians and that
the units of length and area are in millimeters. This is important in
order to scale muscle force properly.</p>
</div>
<div class="section level2">
<h2 id="estimating-muscle-force">Estimating muscle force<a class="anchor" aria-label="anchor" href="#estimating-muscle-force"></a>
</h2>
<p>PCSA multiplied by the specific tension of the muscle tissue, <span class="math inline">\(T_{specific}\)</span>, yields an estimate of
muscle force output (Porro et al., 2011; Holmes and Taylor, 2021). <span class="math inline">\(T_{specific}\)</span> (<code>Tspec</code>)
defaults to 0.3 <span class="math inline">\(N / mm^2\)</span>, which is
a reasonable value for reptile muscle.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Muscle_Force.html">muscle_force</a></span><span class="op">(</span><span class="va">PCSA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 501.2537</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="putting-it-together">Putting it together<a class="anchor" aria-label="anchor" href="#putting-it-together"></a>
</h2>
<p>We can now estimate muscle force for mPTd and scale the ternary plot
points according to size.</p>
<p>We will add a column to <code>mPTd</code> with the force
estimates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mPTd</span> <span class="op">&lt;-</span> <span class="va">mPTd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Force <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/Muscle_Force.html">muscle_force</a></span><span class="op">(</span><span class="fu"><a href="../reference/PCSA.html">pcsa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"L_mPTd_Or.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"L_mPTd_Ins.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="../reference/Muscle_Force.html">muscle_force</a></span><span class="op">(</span><span class="fu"><a href="../reference/PCSA.html">pcsa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"R_mPTd_Or.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                            <span class="st">"R_mPTd_Ins.stl"</span>,</span>
<span>                                            package <span class="op">=</span> <span class="st">"MuscleTernary"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">mPTd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 9</span></span></span>
<span><span class="co">#&gt;   muscle side  x_origin y_origin z_origin x_insertion y_insertion z_insertion</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mPTd   left      26.7     21.4    -<span style="color: #BB0000;">456.</span>        64.8       8.53        -<span style="color: #BB0000;">568.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> mPTd   right    -<span style="color: #BB0000;">23.4</span>     18.7    -<span style="color: #BB0000;">460.</span>       -<span style="color: #BB0000;">67.2</span>      -<span style="color: #BB0000;">0.988</span>       -<span style="color: #BB0000;">560.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: Force &lt;dbl&gt;</span></span></span></code></pre></div>
<p>And make a ternary plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/coords_to_ternary.html">coords_to_ternary</a></span><span class="op">(</span><span class="va">mPTd</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/ggtern.html" class="external-link">ggtern</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, color <span class="op">=</span> <span class="va">side</span>, size <span class="op">=</span> <span class="va">Force</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="centroid_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>By default, ggplot scales the point range to maximize difference, so
the relatively small difference between left and right is exaggerated.
See the article “Make a ternary plot” for details on modifying the size
scale range.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Cost IN, Middleton KM, Sellers KC, Echols MS, Witmer LM, Davis JL,
Holliday CM. 2020. Palatal Biomechanics and Its Significance for Cranial
Kinesis in <em>Tyrannosaurus rex</em>. <a href="http://dx.doi.org/10.1002/ar.24219" class="external-link">Anat Rec 303:999-1017.</a></p>
<p>Cost IN, Sellers KC, Rozin RE, Spates AT, Middleton KM, Holliday CM.
2022. 2D and 3D visualizations of archosaur jaw muscle mechanics,
ontogeny and phylogeny using ternary diagrams and 3D modeling. <a href="http://dx.doi.org/10.1242/jeb.243216" class="external-link">J Exp Biol 225</a></p>
<p>Holmes, M., and A. B. Taylor. 2021. The influence of jaw-muscle
fibre-type phenotypes on estimating maximum muscle and bite forces in
primates. Interface Focus 11:20210009.</p>
<p>Porro, L. B., C. M. Holliday, F. Anapol, L. C. Ontiveros, L. T.
Ontiveros, and C. F. Ross. 2011. Free body analysis, beam mechanics, and
finite element modeling of the mandible of <em>Alligator
mississippiensis</em>. <a href="http://dx.doi.org/10.1002/jmor.10957" class="external-link">J.
Morphol. 272:910-937.</a></p>
<p>Sellers, K. C., K. M. Middleton, J. L. Davis, and C. M. Holliday.
2017. Ontogeny of bite force in a validated biomechanical model of the
American alligator. <a href="http://dx.doi.org/10.1242/jeb.156281" class="external-link">J.
Exp. Biol. 220:2036-2046.</a></p>
<p>Wilken AT, Middleton KM, Sellers KC, Cost IN, Holliday CM. 2019. The
roles of joint tissues and jaw muscles in palatal biomechanics of the
Savannah monitor (<em>Varanus exanthematicus</em>) and their
significance for cranial kinesis. <a href="http://dx.doi.org/10.1242/jeb.201459" class="external-link">J Exp Biol 222:1-14.</a></p>
<p>Wilken AT, Sellers KC, Cost IN, Rozin RE, Middleton KM, Holliday CM.
2020. Connecting the chondrocranium: Biomechanics of the suspensorium in
reptiles. <a href="http://dx.doi.org/10.26049/VZ70-3-2020-02" class="external-link">Vertebrate
Zoology 70:275-290.</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Middleton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
